
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.6">
    
    
      
        <title>CP4D 2.5 installation on TEC - Tips for CP4D and OpenShift</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6910b76c.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.196e0c26.min.css">
        
          
          
          <meta name="theme-color" content="#2094f3">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue" data-md-color-accent="blue">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cp4d-25-installation-on-tec" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Tips for CP4D and OpenShift" class="md-header-nav__button md-logo" aria-label="Tips for CP4D and OpenShift">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Tips for CP4D and OpenShift
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              CP4D 2.5 installation on TEC
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Tips for CP4D and OpenShift" class="md-nav__button md-logo" aria-label="Tips for CP4D and OpenShift">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Tips for CP4D and OpenShift
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../db2-roks.md" class="md-nav__link">
      Db2 on ROKS Gen2
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#downloads" class="md-nav__link">
    Downloads
  </a>
  
    <nav class="md-nav" aria-label="Downloads">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-ibmers" class="md-nav__link">
    For IBMers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-clients" class="md-nav__link">
    For clients
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation-with-nfs" class="md-nav__link">
    Installation with NFS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prereqs" class="md-nav__link">
    Prereqs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#watson-studio" class="md-nav__link">
    Watson Studio
  </a>
  
    <nav class="md-nav" aria-label="Watson Studio">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prereqs_1" class="md-nav__link">
    Prereqs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installation_1" class="md-nav__link">
    Installation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark" class="md-nav__link">
    Spark
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#watson-knowledge-catalog" class="md-nav__link">
    Watson Knowledge Catalog
  </a>
  
    <nav class="md-nav" aria-label="Watson Knowledge Catalog">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prereqs_2" class="md-nav__link">
    Prereqs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kernel-configuration" class="md-nav__link">
    Kernel configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster-configuration" class="md-nav__link">
    Cluster configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installation_2" class="md-nav__link">
    Installation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#watson-openscale" class="md-nav__link">
    Watson OpenScale
  </a>
  
    <nav class="md-nav" aria-label="Watson OpenScale">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster-configuration_1" class="md-nav__link">
    Cluster configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installation_3" class="md-nav__link">
    Installation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#watson-machine-learning" class="md-nav__link">
    Watson Machine Learning
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tips" class="md-nav__link">
    Tips
  </a>
  
    <nav class="md-nav" aria-label="Tips">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error-initializing-source-docker" class="md-nav__link">
    Error initializing source docker...
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#full-restart" class="md-nav__link">
    Full restart
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="cp4d-25-installation-on-tec">CP4D 2.5 installation on TEC</h1>
<p>I did all actions from the master server (second server in the list) through ssh. You can connect through the second public IP (10.99.mmm.nnn). Then all installation is done through the internal IP (192.168.1.nnn)</p>
<p><code>$ ssh root@10.99.mmm.nnn</code></p>
<p>for each prereqs, I test them with the --apply option to check what will be done and then I apply them.</p>
<h2 id="downloads">Downloads</h2>
<p>Get installation files </p>
<h3 id="for-ibmers">For IBMers</h3>
<pre><code>wget http://icpfs1.svl.ibm.com/zen/cp4d-builds/2.5.0.0/production/installer/63/cpd-linux
wget http://icpfs1.svl.ibm.com/zen/cp4d-builds/2.5.0.0/production/internal/repo.yaml
</code></pre>
<p>icpfs1 server is IBM internal only, and cannot be reached from TEC servers. Download the files on your PC while connected to IBM VPN and then send them to TEC servers while connected to TEC VPN. </p>
<h3 id="for-clients">For clients</h3>
<p>Get CPD installer &amp; API keyfor customers :</p>
<p>from passport advantage (CC3Y1ML) (the bin will download the tgz)</p>
<p>or get the installer direclty :</p>
<p><a href="https://ibm-open-platform.ibm.com/repos/cpd/v2.5/EE/cloudpak4data-ee-v2.5.0.0.tgz">https://ibm-open-platform.ibm.com/repos/cpd/v2.5/EE/cloudpak4data-ee-v2.5.0.0.tgz</a></p>
<p>then get your API key :</p>
<p><a href="https://myibm.ibm.com/products-services/containerlibrary">https://myibm.ibm.com/products-services/containerlibrary</a></p>
<h2 id="installation-with-nfs">Installation with NFS</h2>
<p>I did all installation with NFS as an NFS server comes preconfigured. I don't know the status of Portwaorx at the time I write this documentation and if it will become the new standard.</p>
<h2 id="prereqs">Prereqs</h2>
<pre><code># chmod a+x ./cpd-linux
# ./cpd-linux adm --repo repo.yaml --assembly lite --namespace zen
# ./cpd-linux adm --repo repo.yaml --assembly lite --namespace zen —apply
</code></pre>
<p>Zen projects is created by the script</p>
<h2 id="installation">Installation</h2>
<pre><code># oc project zen

Already on project &quot;zen&quot; on server &quot;https://192.168.1.101:8443”.

# ./cpd-linux --repo repo.yaml --assembly lite --namespace zen -c nfs-client --transfer-image-to=docker-registry.default.svc:5000/zen --target-registry-username=$(oc whoami) --target-registry-password=$(oc whoami -t) --accept-all-licenses
</code></pre>
<p>Everything should run fine</p>
<p>You can access CP4D at <a href="https://zen-cpd-zen.apps.tec.uk.ibm.com/">https://zen-cpd-zen.apps.tec.uk.ibm.com/</a></p>
<p>The default login is admin / password</p>
<p>PS : don't forget to connect to the VPN to get access, I often miss this part and wonder why my installation is down ;)</p>
<p>CP4D 2.5 installation is minimal, even Watson Studio is not installed</p>
<h2 id="watson-studio">Watson Studio</h2>
<p>Source : <a href="https://www.ibm.com/support/producthub/icpdata/docs/content/SSQNUZ_current/wsj/install/install-ws.html">https://www.ibm.com/support/producthub/icpdata/docs/content/SSQNUZ_current/wsj/install/install-ws.html</a></p>
<p>So now let’s install Watson Studio</p>
<p>Set the parameter on every node in the cluster:
echo "vm.max_map_count=262144" &gt;&gt; /etc/sysctl.conf ; sysctl -p</p>
<p>Set the time zone for the master node</p>
<pre><code># vi override.yaml

global:
    masterTimezone: 'Europe/Paris'
</code></pre>
<h3 id="prereqs_1">Prereqs</h3>
<pre><code># ./cpd-linux adm --repo repo.yaml  --assembly wsl --namespace zen --apply
# ./cpd-linux adm --repo repo.yaml  --assembly wsl --namespace zen
</code></pre>
<h3 id="installation_1">Installation</h3>
<pre><code># ./cpd-linux --repo repo.yaml --assembly wsl --namespace zen -c nfs-client --transfer-image-to=docker-registry.default.svc:5000/zen --target-registry-username=$(oc whoami) --target-registry-password=$(oc whoami -t) --accept-all-licenses —override override.yaml
</code></pre>
<h3 id="spark">Spark</h3>
<p>Let's install also Spark engine in order to get Spark environment in Studio</p>
<pre><code># ./cpd-linux --repo repo.yaml --assembly spark --namespace zen -c nfs-client --transfer-image-to=docker-registry.default.svc:5000/zen --target-registry-username=$(oc whoami) --target-registry-password=$(oc whoami -t) --accept-all-licenses —override override.yaml
</code></pre>
<p>You now have a basic CP4D installation. Let's add some addons now.</p>
<h2 id="watson-knowledge-catalog">Watson Knowledge Catalog</h2>
<p>Source : <a href="https://www.ibm.com/support/producthub/icpdata/docs/content/SSQNUZ_current/wsj/install/install-wkc.html">https://www.ibm.com/support/producthub/icpdata/docs/content/SSQNUZ_current/wsj/install/install-wkc.html</a></p>
<h3 id="prereqs_2">Prereqs</h3>
<p>Add the following line in /etc/security/limits.conf</p>
<pre><code># vi /etc/security/limits.conf
[…]
*               hard    nofile          66560
*               soft    nofile          66560
</code></pre>
<h3 id="kernel-configuration">Kernel configuration</h3>
<p>Update kernel on all server (Masters and workers)</p>
<pre><code># echo &quot;kernel.sem = 250 1024000 32 4096&quot; &gt;&gt; /etc/sysctl.conf ; sysctl -p
# echo &quot;kernel.msgmax = 65536&quot; &gt;&gt; /etc/sysctl.conf ; sysctl -p
# echo &quot;kernel.msgmnb = 65536&quot; &gt;&gt; /etc/sysctl.conf ; sysctl -p
# ipcs -l
</code></pre>
<h3 id="cluster-configuration">Cluster configuration</h3>
<pre><code># ./cpd-linux adm --repo repo.yaml  --assembly wkc --namespace zen —apply
# ./cpd-linux adm --repo repo.yaml  --assembly wkc --namespace zen
</code></pre>
<h3 id="installation_2">Installation</h3>
<pre><code># ./cpd-linux --repo repo.yaml --assembly wkc --namespace zen -c nfs-client --transfer-image-to=docker-registry.default.svc:5000/zen --target-registry-username=$(oc whoami) --target-registry-password=$(oc whoami -t) --accept-all-licenses --override override.yaml --ask-pull-registry-credentials
</code></pre>
<h2 id="watson-openscale">Watson OpenScale</h2>
<p>Source : <a href="https://www.ibm.com/support/producthub/icpdata/docs/content/SSQNUZ_current/cpd/svc/openscale/openscale-install.html">https://www.ibm.com/support/producthub/icpdata/docs/content/SSQNUZ_current/cpd/svc/openscale/openscale-install.html</a></p>
<h3 id="cluster-configuration_1">Cluster configuration</h3>
<pre><code># ./cpd-linux adm --repo repo.yaml  --assembly aiopenscale --namespace zen —apply
# ./cpd-linux adm --repo repo.yaml  --assembly aiopenscale --namespace zen
</code></pre>
<h3 id="installation_3">Installation</h3>
<pre><code># ./cpd-linux --repo repo.yaml --assembly aiopenscale --namespace zen -c nfs-client --transfer-image-to=docker-registry.default.svc:5000/zen --target-registry-username=$(oc whoami) --target-registry-password=$(oc whoami -t) --accept-all-licenses --override override.yaml --ask-pull-registry-credentials
</code></pre>
<h2 id="watson-machine-learning">Watson Machine Learning</h2>
<p>Source : <a href="https://www.ibm.com/support/producthub/icpdata/docs/content/SSQNUZ_current/cpd/svc/wsj/ml-install.html">https://www.ibm.com/support/producthub/icpdata/docs/content/SSQNUZ_current/cpd/svc/wsj/ml-install.html</a></p>
<pre><code># ./cpd-linux --repo repo.yaml --assembly wml --namespace zen -c nfs-client --transfer-image-to=docker-registry.default.svc:5000/zen --target-registry-username=$(oc whoami) --target-registry-password=$(oc whoami -t) --accept-all-licenses --override override.yaml --ask-pull-registry-credentials
</code></pre>
<h2 id="tips">Tips</h2>
<p>Here are some tips on installation and issue solving</p>
<h3 id="error-initializing-source-docker">Error initializing source docker...</h3>
<p>If you have an issue like "Error initializing source docker://cp.icr.io/cp/cpd/zen-meta-couchdb:v2.5.0.0-210: unable to retrieve auth token: invalid username/password”, check the credentials in repo.yaml.</p>
<p>They change sometimes so refresh the repo.yaml, or better use the myibm key from https://myibm.ibm.com/products-services/containerlibrary. Username is cp in this case.</p>
<h3 id="full-restart">Full restart</h3>
<p>In some case, debugging a single pod is not enough. I sometimes restart all CP4D with this command to restar all the pods.</p>
<p><code># oc delete pods -n zen --all</code></p>
<p>It may take a while to restart all the pods, depending on the number of addons you have installed.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.fd16492e.min.js"></script>
      <script src="../assets/javascripts/bundle.7836ba4d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>